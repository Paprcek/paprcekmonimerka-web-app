{% extends "base.html" %}

{% block title %}Historická Data AQI{% endblock %}

{% block content %}
    <h1>Historie Kvality Vzduchu (Posledních 72 hodin)</h1>
    <p>Vizualizace vývoje indexu AQI (Air Quality Index) a koncentrace PM2.5 v čase.</p>

    {% if error_message %}
        <!-- CHYBOVÉ HLÁŠENÍ -->
        <div class="data-box status-unknown" style="max-width: 800px;">
            <h2>{{ error_title }}</h2>
            <p>{{ error_message }}</p>
            <p>Historická data jsou náročnější na API, prosím zkontrolujte klíč a zkuste to znovu.</p>
        </div>
    {% else %}
        <!-- CONTAINER PRO GRAF -->
        <div class="data-box" style="max-width: 100%; min-height: 500px; margin-top: 30px;">
            <!-- Canvas, do ktereho Chart.js vykresli graf -->
            <canvas id="airQualityChart"></canvas>
        </div>

        <!-- SCRIPT PRO CHART.JS -->
        <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
        <script>
            // Data zaslana z Flask backendu (Jinja2)
            const labels = {{ labels | tojson }};
            const aqiValues = {{ aqi_values | tojson }};
            const pm25Values = {{ pm25_values | tojson }};

            // Kontext pro vykresleni grafu
            const ctx = document.getElementById('airQualityChart').getContext('2d');
            
            // Konfigurace a vykresleni grafu
            new Chart(ctx, {
                type: 'line', // Typ grafu - cara
                data: {
                    labels: labels, // Casove razitka (HH:MM dd.mm.)
                    datasets: [
                        {
                            label: 'AQI Index (1-5)',
                            data: aqiValues,
                            borderColor: 'rgb(75, 192, 192)', // Modrozelena
                            backgroundColor: 'rgba(75, 192, 192, 0.2)',
                            borderWidth: 2,
                            fill: false,
                            yAxisID: 'y' // Pouziva levy Y-osa
                        },
                        {
                            label: 'PM2.5 (µg/m³)',
                            data: pm25Values,
                            borderColor: 'rgb(255, 99, 132)', // Cervena
                            backgroundColor: 'rgba(255, 99, 132, 0.2)',
                            borderWidth: 2,
                            fill: false,
                            yAxisID: 'y1' // Pouziva pravy Y-osa
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false, // Dovoluje sirku 100%
                    scales: {
                        x: {
                            title: {
                                display: true,
                                text: 'Datum a čas',
                                color: '#f0f0f0'
                            },
                            ticks: {
                                color: '#f0f0f0',
                                maxTicksLimit: 12 // Omezime pocet stitku pro prehlednost
                            }
                        },
                        y: {
                            type: 'linear',
                            display: true,
                            position: 'left',
                            title: {
                                display: true,
                                text: 'AQI Index',
                                color: 'rgb(75, 192, 192)'
                            },
                            min: 0,
                            max: 5, // AQI je 1-5
                            ticks: {
                                stepSize: 1,
                                color: 'rgb(75, 192, 192)'
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            }
                        },
                        y1: {
                            type: 'linear',
                            display: true,
                            position: 'right',
                            title: {
                                display: true,
                                text: 'PM2.5 Koncentrace (µg/m³)',
                                color: 'rgb(255, 99, 132)'
                            },
                            grid: {
                                drawOnChartArea: false, // Nechceme, aby se mrizka PM2.5 kreslila pres graf
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: 'rgb(255, 99, 132)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                color: '#f0f0f0' // Barva popisku legendy
                            }
                        },
                        tooltip: {
                            backgroundColor: 'rgba(44, 44, 44, 0.9)' // Tmavé pozadí tooltipu
                        }
                    }
                }
            });
        </script>
    {% endif %}
{% endblock %}
